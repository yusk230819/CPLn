
name: CPLn-Build

on: [push]

jobs:
  build:
    runs-on: windows-latest
    steps:
      # --- ここから追加 ---
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10' # 使うバージョンを指定

      - name: Install Dependencies
        shell: msys2 {0}
        run: |
          # Python開発用パッケージとpkg-configを確実にインストール
          pacman -S --noconfirm mingw-w64-x86_64-python mingw-w64-x86_64-pkg-config
          pacman -S --noconfirm mingw-w64-x86_64-sdl2 mingw-w64-x86_64-sdl


      - name: Compile       
        shell: msys2 {0}
        run: |
          # 1. Pythonの「設計図(include)」と「部品(libs)」の場所を特定
          PY_INC=$(pkg-config --cflags python3)
          PY_LIB=$(pkg-config --libs python3)

          # 2. SDL2の「設計図(include)」と「部品(libs)」の場所を特定
          SDL_INC=$(pkg-config --cflags sdl2 SDL2_ttf)
          SDL_LIB=$(pkg-config --libs sdl2 SDL2_ttf)

          # 3. $PY_FLAGS のような嘘の変数は使わず、特定したパスを全部並べる
          # これで「Python.h」が見つかり、dllのリンクも通ります
          gcc *.c -o CPLn.exe $PY_INC $SDL_INC $PY_LIB $SDL_LIB -lws2_32




