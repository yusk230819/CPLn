
name: CPLn-Build

on: [push]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4

      # 1. 道具を全部入れる（ここが抜けているとエラーになります！）
      - name: Install Dependencies
        uses: msys2/setup-msys2@v2
        with:
          update: true
          install: >-
            mingw-w64-x86_64-gcc
            mingw-w64-x86_64-SDL2
            mingw-w64-x86_64-SDL2_ttf
            mingw-w64-x86_64-python
            pkg-config

      # 2. コンパイルする
      - name: Compile
        shell: msys2 {0}
        run: |
          # 道具の場所を確認して変数に入れる
          PY_CFLAGS=$(pkg-config --cflags python3)
          PY_LIBS=$(pkg-config --libs python3)
          SDL_FLAGS=$(pkg-config --cflags --libs sdl2 SDL2_ttf)

          # まとめてコンパイル（順番が大事！）
          gcc *.c -o CPLn.exe $PY_FLAGS $SDL_FLAGS -lws2_32


      # 3. 完成したEXEを保存する
      - name: Upload EXE
        uses: actions/upload-artifact@v4
        with:
          name: CPLn-Result
          path: CPLn.exe
